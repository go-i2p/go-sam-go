<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>go-i2p/go-sam-go</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <nav class="nav-sidebar">
    <div class="repo-info">
      <h2>
        <a href="index.html">go-i2p/go-sam-go</a>
      </h2>
      <div class="repo-meta">
        üìù 225 commits
        
      </div>
    </div>
    
    <ul class="nav-links">
      <li><a href="index.html" class="active">Repository Overview</a></li>
      
      
        <div class="nav-section-title">Documentation:</div>
        
          <li><a href="docs/SAMv3.html">SAM V3</a></li>
        
          <li><a href="docs/common/DOC.html">common</a></li>
        
          <li><a href="docs/datagram/DOC.html">datagram</a></li>
        
          <li><a href="docs/datagram2/DOC.html">datagram2</a></li>
        
          <li><a href="docs/datagram3/DOC.html">datagram3</a></li>
        
          <li><a href="docs/primary/DOC.html">primary</a></li>
        
          <li><a href="docs/raw/DOC.html">raw</a></li>
        
          <li><a href="docs/DOC.html">sam3</a></li>
        
          <li><a href="docs/sigs.html">sam3</a></li>
        
          <li><a href="docs/stream/DOC.html">stream</a></li>
        
      
    </ul>
    
    <div class="nav-footer">
      <a href="https://github.com/go-i2p/go-sam-go" target="_blank">View on GitHub</a>
    </div>
  </nav>
  
  <div class="main-content">
    <header class="repo-header">
      <h1>go-i2p/go-sam-go</h1>
      <div class="repo-description">[![Go Reference](https://pkg.go.dev/badge/github.com/go-i2p/go-sam-go.svg)](https://pkg.go.dev/github.com/go-i2p/go-sam-go)</div>
      
      <div class="repo-stats">
        
        <div class="repo-stat">
          <span>üìù</span> <span>225 commits</span>
        </div>
        
        
        <div class="repo-stat">
          <span>üìÖ</span> <span>Last updated: October 20, 2025</span>
        </div>
        
        
      </div>
    </header>
    
    <main>
      
      <section id="readme" class="repo-section">
        <h2>README</h2>
        <div class="readme-content">
          <h1 id="go-sam-go">go-sam-go</h1>

<p><a href="https://pkg.go.dev/github.com/go-i2p/go-sam-go" target="_blank"><img src="https://pkg.go.dev/badge/github.com/go-i2p/go-sam-go.svg" alt="Go Reference" /></a>
<a href="https://goreportcard.com/report/github.com/go-i2p/go-sam-go" target="_blank"><img src="https://goreportcard.com/badge/github.com/go-i2p/go-sam-go" alt="Go Report Card" /></a></p>

<p>A pure-Go implementation of SAMv3.3 (Simple Anonymous Messaging) for I2P, focused on maintainability and clean architecture. This project is forked from <code>github.com/go-i2p/sam3</code> with reorganized code structure.</p>

<h2 id="implementation-status">‚ö†Ô∏è Implementation Status</h2>

<p><strong>Stable &amp; Production-Ready:</strong></p>

<ul>
<li>‚úÖ <strong>Stream</strong> - TCP-like reliable connections (fully tested)</li>
<li>‚úÖ <strong>Datagram</strong> - Legacy authenticated repliable datagrams (fully tested, SAMv3 UDP forwarding required)</li>
<li>‚úÖ <strong>Raw</strong> - Encrypted unauthenticated datagrams (fully tested, SAMv3 UDP forwarding required)</li>
<li>‚úÖ <strong>Primary Sessions</strong> - Multi-session management (fully implemented with comprehensive lifecycle management)</li>
</ul>

<p><strong>Implemented &amp; Documented (Awaiting I2P Router Support):</strong></p>

<ul>
<li>‚ö†Ô∏è <strong>Datagram2</strong> - Authenticated repliable datagrams with replay protection (spec finalized early 2025, no router implementations yet, available in dev builds)</li>
<li>‚ö†Ô∏è <strong>Datagram3</strong> - Unauthenticated repliable datagrams with hash-based sources (spec finalized early 2025, no router implementations yet, available in dev builds, requires direct package import)</li>
</ul>

<p><strong>Note:</strong> DATAGRAM2 and DATAGRAM3 are fully implemented in this library but require I2P router support (Java I2P or i2pd) to function. Check your router&rsquo;s release notes for SAMv3 DATAGRAM2/3 support.</p>

<h2 id="installation">üì¶ Installation</h2>

<pre><code class="language-bash">go get github.com/go-i2p/go-sam-go
</code></pre>

<h3 id="dependencies">Dependencies</h3>

<ul>
<li><code>github.com/go-i2p/i2pkeys</code> v0.33.92 - I2P cryptographic key management</li>
<li><code>github.com/go-i2p/crypto</code> - I2P-specific cryptographic operations</li>
<li><code>github.com/sirupsen/logrus</code> v1.9.3 - Structured logging</li>
<li><code>github.com/samber/oops</code> v1.19.0 - Enhanced error handling</li>
</ul>

<h2 id="quick-start">üöÄ Quick Start</h2>

<pre><code class="language-go">package main

import (
    &quot;github.com/go-i2p/go-sam-go&quot;
)

func main() {
    // Create SAM client
    client, err := sam3.NewSAM(&quot;127.0.0.1:7656&quot;)
    if err != nil {
        panic(err)
    }
    defer client.Close()
    
    // Generate keys (optionally specify signature type)
    keys, err := client.NewKeys() // Uses default EdDSA_SHA512_Ed25519
    // Or: keys, err := client.NewKeys(sam3.Sig_ECDSA_SHA256_P256)
    if err != nil {
        panic(err)
    }
    
    // Create streaming session
    session, err := client.NewStreamSession(&quot;myTunnel&quot;, keys, sam3.Options_Default)
    if err != nil {
        panic(err)
    }
}
</code></pre>

<h2 id="api-documentation">üìö API Documentation</h2>

<h3 id="root-package-sam3">Root Package (<code>sam3</code>)</h3>

<p>The root package provides a high-level wrapper API:</p>

<pre><code class="language-go">client, err := sam3.NewSAM(&quot;127.0.0.1:7656&quot;)
</code></pre>

<p>Available session types:</p>

<ul>
<li><code>NewStreamSession()</code> - For reliable TCP-like connections</li>
<li><code>NewDatagramSession()</code> - For UDP-like messaging</li>
<li><code>NewRawSession()</code> - For encrypted but unauthenticated datagrams</li>
<li><code>NewPrimarySession()</code> - For creating multiple sub-sessions</li>
</ul>

<h3 id="sub-packages">Sub-packages</h3>

<h4 id="primary-package"><code>primary</code> Package</h4>

<p>Core session management functionality:</p>

<pre><code class="language-go">primary, err := sam.NewPrimarySession(&quot;mainSession&quot;, keys, options)
sub1, err := primary.NewStreamSubSession(&quot;web&quot;)
sub2, err := primary.NewDatagramSubSession(&quot;chat&quot;) 
</code></pre>

<h4 id="stream-package"><code>stream</code> Package</h4>

<p>TCP-like reliable connections:</p>

<pre><code class="language-go">listener, err := session.Listen()
conn, err := listener.Accept()  // Reuse listener for multiple connections
// or for single connection (creates new listener each time - less efficient)
conn, err := session.Accept()
// or dial outbound
conn, err := session.DialI2P(remote)
</code></pre>

<p><strong>Performance Note:</strong> For servers accepting multiple connections, use <code>Listen()</code> once and call <code>Accept()</code> on the listener. The <code>session.Accept()</code> method creates and destroys a new listener for each call, which is inefficient for high-traffic scenarios.</p>

<h4 id="datagram-package"><code>datagram</code> Package</h4>

<p>UDP-like message delivery with SAMv3 UDP forwarding:</p>

<pre><code class="language-go">// SAMv3 UDP forwarding is mandatory - creates local UDP listener automatically
// Port parameter: 0 = OS-assigned port for local UDP listener (not SAM bridge port 7655)
dgram, err := sam.NewDatagramSession(&quot;udp&quot;, keys, options, 0)
n, err := dgram.WriteTo(data, dest)
</code></pre>

<p><strong>Important:</strong> All datagram sessions in this library use SAMv3 UDP forwarding. A local UDP listener is automatically created for receiving forwarded datagrams from the I2P router. The port parameter specifies the local listener port (0 for auto-assignment), NOT the SAM bridge&rsquo;s UDP port (which defaults to 7655).</p>

<h4 id="raw-package"><code>raw</code> Package</h4>

<p>Low-level datagram access with SAMv3 UDP forwarding:</p>

<pre><code class="language-go">// SAMv3 UDP forwarding is mandatory - creates local UDP listener automatically
// Port parameter: 0 = OS-assigned port for local UDP listener (not SAM bridge port 7655)
raw, err := sam.NewRawSession(&quot;raw&quot;, keys, options, 0)
n, err := raw.WriteTo(data, dest)
</code></pre>

<p><strong>Important:</strong> All raw sessions in this library use SAMv3 UDP forwarding. A local UDP listener is automatically created for receiving forwarded datagrams from the I2P router. The port parameter specifies the local listener port (0 for auto-assignment), NOT the SAM bridge&rsquo;s UDP port.</p>

<h4 id="datagram2-package"><code>datagram2</code> Package</h4>

<p>Authenticated repliable datagrams with replay protection:</p>

<pre><code class="language-go">// DATAGRAM2 - Authenticated with replay protection (requires router support)
// Specification finalized early 2025, awaiting I2P router implementation
import &quot;github.com/go-i2p/go-sam-go/datagram2&quot;

session, err := datagram2.NewDatagram2Session(sam, &quot;session-id&quot;, keys, options)
if err != nil {
    // Handle error - may fail if router doesn't support DATAGRAM2 yet
    log.Fatal(err)
}
defer session.Close()

// Send authenticated datagram
err = session.SendDatagram(data, destination)

// Receive with full authentication
conn := session.PacketConn()
n, addr, err := conn.ReadFrom(buffer)
</code></pre>

<p><strong>Security:</strong> Provides cryptographic authentication and replay protection. Recommended for new applications requiring source verification.</p>

<p><strong>Status:</strong> Implementation complete. Waiting for I2P router support (Java I2P 0.9.x+ or i2pd 2.x+).</p>

<h4 id="datagram3-package"><code>datagram3</code> Package</h4>

<p>‚ö†Ô∏è <strong>SECURITY WARNING:</strong> Unauthenticated repliable datagrams with hash-based sources:</p>

<p><strong>Note:</strong> Datagram3 is not integrated into the root <code>sam3</code> package API. You must import and use the <code>datagram3</code> package directly.</p>

<pre><code class="language-go">// DATAGRAM3 - UNAUTHENTICATED sources (requires router support + app-layer auth)
// Sources are 32-byte hashes that can be spoofed - implement your own authentication!
import &quot;github.com/go-i2p/go-sam-go/datagram3&quot;
import &quot;github.com/go-i2p/go-sam-go/common&quot;

// Create SAM connection using common package
samCommon, err := common.NewSAM(&quot;127.0.0.1:7656&quot;)
if err != nil {
    log.Fatal(err)
}

session, err := datagram3.NewDatagram3Session(samCommon, &quot;session-id&quot;, keys, options)
if err != nil {
    log.Fatal(err)
}
defer session.Close()

// Receive datagram with UNAUTHENTICATED source hash
reader := session.NewReader()
datagram, err := reader.ReceiveDatagram()

// ‚ö†Ô∏è Source hash is NOT authenticated - verify at application layer!
// Resolve hash to destination for reply (requires NAMING LOOKUP)
err = datagram.ResolveSource(session)

// Send reply
writer := session.NewWriter()
err = writer.SendDatagram(replyData, datagram.Source)
</code></pre>

<p><strong>Status:</strong> Implementation complete with documentation. Waiting for I2P router support.</p>

<h3 id="configuration">Configuration</h3>

<p>Built-in configuration profiles:</p>

<pre><code class="language-go">sam3.Options_Default     // Balanced defaults
sam3.Options_Small      // Minimal resources
sam3.Options_Medium     // Enhanced reliability 
sam3.Options_Large      // High throughput
sam3.Options_Humongous  // Maximum performance
</code></pre>

<h3 id="logging-configuration">Logging Configuration</h3>

<p>This library uses <code>github.com/go-i2p/logger</code> for structured logging with environment-based configuration:</p>

<h4 id="verbosity-control">Verbosity Control</h4>

<p>Control logging output via the <code>DEBUG_I2P</code> environment variable:</p>

<pre><code class="language-bash">export DEBUG_I2P=debug   # Verbose debugging (tunnel state, operations, timing)
export DEBUG_I2P=warn    # Warnings only (deprecations, recoverable issues)
export DEBUG_I2P=error   # Errors only (failed operations, connectivity issues)
# Unset = No logging (zero performance impact)
</code></pre>

<h4 id="fast-fail-mode-testing-development">Fast-Fail Mode (Testing &amp; Development)</h4>

<p>Enable strict mode where warnings and errors become fatal:</p>

<pre><code class="language-bash">export WARNFAIL_I2P=true  # Convert warnings/errors to fatal for testing
go test ./...              # Tests fail fast on any warning/error
</code></pre>

<p><strong>Use Case:</strong> Catch potential issues during development that might be warnings in production.</p>

<h4 id="structured-logging">Structured Logging</h4>

<p>The logger provides structured, searchable output with contextual fields:</p>

<pre><code>time=&quot;2025-01-20T15:04:05Z&quot; level=debug msg=&quot;SAM session created&quot; session_id=&quot;mytunnel&quot; signature_type=&quot;EdDSA_SHA512_Ed25519&quot; tunnel_in_length=3 tunnel_out_length=3
time=&quot;2025-01-20T15:04:10Z&quot; level=info msg=&quot;Connection established&quot; remote_dest=&quot;abc123...def.b32.i2p&quot; connection_time=&quot;2.3s&quot;
time=&quot;2025-01-20T15:04:15Z&quot; level=error msg=&quot;Failed to send datagram&quot; error=&quot;connection timeout&quot; session_id=&quot;udp-tunnel&quot; retry_count=3
</code></pre>

<h4 id="logging-best-practices">Logging Best Practices</h4>

<ol>
<li><strong>Production:</strong> Leave <code>DEBUG_I2P</code> unset for zero logging overhead</li>
<li><strong>Troubleshooting:</strong> Set <code>DEBUG_I2P=debug</code> to diagnose I2P timing and connectivity issues</li>
<li><strong>Testing:</strong> Use <code>WARNFAIL_I2P=true</code> to enforce clean test runs without warnings</li>
<li><strong>CI/CD:</strong> Combine both for maximum issue detection: <code>DEBUG_I2P=debug WARNFAIL_I2P=true go test ./...</code></li>
</ol>

<h2 id="requirements">üîß Requirements</h2>

<ul>
<li>Go 1.24.2 or later (toolchain go1.24.4)</li>
<li>Running I2P router with SAM bridge enabled (default port: 7656)</li>
<li>For DATAGRAM2/DATAGRAM3: I2P router with SAMv3 DATAGRAM2/3 support (check router release notes)</li>
</ul>

<h2 id="development">üìù Development</h2>

<pre><code class="language-bash"># Format code
make fmt

# Run tests (short mode, no I2P required)
go test -short ./...

# Run full integration tests (requires running I2P router)
# Note: I2P tests can take 30-150 seconds due to tunnel establishment
go test ./...

# Run with race detection
go test -race -short ./...
</code></pre>

<h2 id="package-documentation">üìñ Package Documentation</h2>

<p>Each sub-package has comprehensive documentation:</p>

<ul>
<li><strong><a href="stream/" target="_blank">stream/</a></strong> - TCP-like reliable connections</li>
<li><strong><a href="datagram/" target="_blank">datagram/</a></strong> - Legacy authenticated datagrams</li>
<li><strong><a href="datagram2/" target="_blank">datagram2/</a></strong> - DATAGRAM2 authenticated datagrams with replay protection</li>
<li><strong><a href="datagram3/" target="_blank">datagram3/</a></strong> - DATAGRAM3 unauthenticated datagrams</li>
<li><strong><a href="raw/" target="_blank">raw/</a></strong> - Encrypted unauthenticated datagrams</li>
<li><strong><a href="primary/" target="_blank">primary/</a></strong> - PRIMARY session management</li>
</ul>

<h3 id="i2p-timing-considerations">I2P Timing Considerations</h3>

<p>I2P operations have significant latency due to tunnel-based architecture:</p>

<ul>
<li><strong>Session creation:</strong> 2-5 minutes on initial connection</li>
<li><strong>Message delivery:</strong> Variable (network-dependent)</li>
<li><strong>Best practice:</strong> Use generous timeouts (5+ minutes) and exponential backoff retry logic</li>
</ul>

<p>All tests accommodate I2P timing requirements.</p>

<h2 id="license">üìÑ License</h2>

<p>MIT License</p>

<h2 id="acknowledgments">üôè Acknowledgments</h2>

<p>Based on the original <a href="https://github.com/go-i2p/sam3" target="_blank">github.com/go-i2p/sam3</a> library.</p>

        </div>
      </section>
      
      
      
      <section id="contributors" class="repo-section">
        <h2>Top Contributors</h2>
        <div class="contributors-list">
          
          <div class="contributor-item">
            <!-- Use first letter as avatar if no image available -->
            <div class="contributor-avatar">
              e
            </div>
            <div class="contributor-info">
              <div class="contributor-name">
                eyedeekay
              </div>
              <div class="contributor-commits">
                223 commits
              </div>
            </div>
          </div>
          
          <div class="contributor-item">
            <!-- Use first letter as avatar if no image available -->
            <div class="contributor-avatar">
              C
            </div>
            <div class="contributor-info">
              <div class="contributor-name">
                Call me Phil
              </div>
              <div class="contributor-commits">
                2 commits
              </div>
            </div>
          </div>
          
        </div>
        <a href="https://github.com/go-i2p/go-sam-go/graphs/contributors" target="_blank">View all contributors on GitHub ‚Üí</a>
      </section>
      
    </main>
    
    <footer class="page-footer">
      <p>Generated on 2025-10-22 04:16:11 ‚Ä¢ <a href="https://github.com/go-i2p/go-sam-go" target="_blank">View on GitHub</a></p>
    </footer>
  </div>
</body>
</html>